<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Zend Framework Tutorials">  
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Preparing for Different Databases - tutorials</title>

    <link rel="stylesheet" href="../../css/styles-e95dab66f8.css">
</head>
<body id="page-top">

    
    <div class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">

            
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-tooltip data-placement="bottom" title="Go to the ZF homepage">
                    <img src="../../img/zend-framework-logo.svg" height="28" alt="Zend Framework">
                </a>
            </span>
        </div>

        <div class="navbar-collapse collapse">

            
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://framework.zend.com/about">About</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/downloads">Install</a>
                </li>
                <li class="active">
                    <a href="https://docs.zendframework.com">Documentation</a>
                </li>
                <li>
                    <a href="https://www.zend.com/en/services/training">Training</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/blog">Blog</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/participate">Participate</a>
                </li>
            </ul>

            
            
                <div class="nav navbar-nav navbar-collapse visible-xs-block ">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">tutorials</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            
                
                    <li class="subnavigation__list-item ">
                        <a href="../.." class="subnavigation__link">Tutorials for Zend Framework</a>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">MVC Tutorials</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Getting Started with Zend Framework</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/overview/" class="subnavigation__link">Overview</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/skeleton-application/" class="subnavigation__link">The Skeleton Application</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/modules/" class="subnavigation__link">Modules</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/routing-and-controllers/" class="subnavigation__link">Routing and Controllers</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/database-and-models/" class="subnavigation__link">Database and Models</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/forms-and-actions/" class="subnavigation__link">Forms and Actions</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/conclusion/" class="subnavigation__link">Conclusion</a>
    </li>

            
        </ul>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../unit-testing/" class="subnavigation__link">Unit Testing A zend-mvc Application</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../navigation/" class="subnavigation__link">Adding zend-navigation to the Album Module</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../pagination/" class="subnavigation__link">Adding zend-paginator to the Album Module</a>
    </li>

                            
                                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">In-Depth Tutorial</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../first-module/" class="subnavigation__link">Introducing the Blog Module</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../models-and-servicemanager/" class="subnavigation__link">Models and the ServiceManager</a>
    </li>

            
                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Preparing for Different Databases</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../zend-db-sql-zend-hydrator/" class="subnavigation__link">SQL Abstraction and Object Hydration</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../understanding-routing/" class="subnavigation__link">Understanding the Router</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../zend-form-zend-form-fieldset/" class="subnavigation__link">Making Use of Forms and Fieldsets</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../data-binding/" class="subnavigation__link">Editing and Deleting Data</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../review/" class="subnavigation__link">Reviewing the Blog Module</a>
    </li>

            
        </ul>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../advanced-config/" class="subnavigation__link">Advanced Configuration</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../i18n/" class="subnavigation__link">Internationalization</a>
    </li>

                            
                        </ul>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">Component Tutorials</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../db-adapter/" class="subnavigation__link">Setting Up A Database Adapter</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../event-manager/" class="subnavigation__link">Using the EventManager</a>
    </li>

                            
                        </ul>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">Migration</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">To Version 3</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../migration/to-v3/overview/" class="subnavigation__link">Overview</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../migration/to-v3/components/" class="subnavigation__link">Components</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../migration/to-v3/application/" class="subnavigation__link">Applications</a>
    </li>

            
        </ul>
    </li>

                            
                        </ul>
                    </li>
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="nav navbar-nav navbar-collapse visible-xs-block">
                <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</div>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-xs-8">
                <h1 class="header__title">
                    Documentation

                    
                        <small class="header__subtitle">tutorials</small>
                    
                </h1>
            </div>

            
            <div class="col-xs-4 text-right">
                
                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/zendframework/tutorials/" class="header__link header__link--github" title="Go to repository of tutorials">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-xs-12 content" role="main">
            <!-- content:begin -->
                
                    <ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
    <li><a href="https://framework.zend.com/">Home</a></li>

    
        <li><a href="https://docs.zendframework.com/">Documentation</a></li>

        
            <li><a href="../..">tutorials</a></li>

            
                
                    <li>MVC Tutorials</li>
                
            
                
                    <li>In-Depth Tutorial</li>
                
            

            <li class="active">Preparing for Different Databases</li>
        
    
</ol>


    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">In This Article</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#what-is-database-abstraction" class="toc__link">What is database abstraction?</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#adding-command-abstraction" class="toc__link">Adding command abstraction</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#conclusion" class="toc__link">Conclusion</a>
                    </li>
                
            </ul>
        </div>
    


    <h1 id="preparing-for-different-databases">Preparing for Different Databases</h1>
<p>In the previous chapter, we created a <code>PostRepository</code> that returns some data
from blog posts. While the implementation was adequate for learning purposes, it
is quite impractical for real world applications; no one would want to modify
the source files each time a new post is added! Fortunately, we an always turn
to databases for the actual storage of posts; all we need to learn is how to
interact with databases within our application.</p>
<p>There's one small catch: there are many database backend systems, including
relational databases, documentent databases, key/value stores, and graph
databases. You may be inclined to code directly to the solution that fits your
application's immediate needs, but it is a better practice to create another
layer in front of the actual database access that abstracts the database
interaction. The <em>repository</em> approach we used in the previous chapter is one
such approach, primarily geared towards <em>queries</em>. In this section, we'll expand
on it to add <em>command</em> capabilities for creating, updating, and deleting
records.</p>
<h2 id="what-is-database-abstraction">What is database abstraction?</h2>
<p>"Database abstraction" is the act of providing a common interface for all
database interactions. Consider a SQL and a NoSQL database; both have methods
for CRUD (Create, Read, Update, Delete) operations. For example, to query the
database against a given row in MySQL you might use</p>
<pre class="codehilite"><code class="language-php">$results = mysqli_query('SELECT foo FROM bar')`;</code></pre>

<p>However, for MongoDB,  for example you'd use something like:</p>
<pre class="codehilite"><code class="language-php">$results = $mongoDbClient-&gt;app-&gt;bar-&gt;find([], ['foo' =&gt; 1, '_id' =&gt; 0])`;</code></pre>

<p>Both engines would give you the same result, but the execution is different.</p>
<p>So if we start using a SQL database and write those codes directly into our
<code>PostRepository</code> and a year later we decide to switch to a NoSQL database, the
existing implementation is useless to us. And in a few years later, when a new
persistence engine pops up, we have to start over yet again.</p>
<p>If we hadn't created an interface first, we'd also likely need to change our
consuming code! </p>
<p>On top of that, we may find that we want to use some sort of distributed caching
layer for <em>read</em> operations (fetching items), while <em>write</em> operations will be
written to a relational database. Most likely, we don't want our controllers to
need to worry about those implementation details, but we will want to ensure
that we account for this in our architecture.</p>
<p>At the code level, the interface is our abstraction layer for dealing with
differences in implementations. However, currently, we only deal with queries.
Let's expand on that.</p>
<h2 id="adding-command-abstraction">Adding command abstraction</h2>
<p>Let's first think a bit about what possible database interactions we can think
of. We need to be able to:</p>
<ul>
<li>find a single blog post</li>
<li>find all blog posts</li>
<li>insert new blog post</li>
<li>update existing blog posts</li>
<li>delete existing blog posts</li>
</ul>
<p>At this time, our <code>PostRepositoryInterface</code> deals with the first two.
Considering this is the layer that is most likely to use different backend
implementations, we probably want to keep it separate from the operations that
cause changes.</p>
<p>Let's create a new interface, <code>Blog\Model\PostCommandInterface</code>, in
<code>module/Blog/src/Model/PostCommandInterface.php</code>, and have it read as follows:</p>
<pre class="codehilite"><code class="language-php">namespace Blog\Model;

interface PostCommandInterface
{
    /**
     * Persist a new post in the system.
     *
     * @param Post $post The post to insert; may or may not have an identifier.
     * @return Post The inserted post, with identifier.
     */
    public function insertPost(Post $post);

    /**
     * Update an existing post in the system.
     *
     * @param Post $post The post to update; must have an identifier.
     * @return Post The updated post.
     */
    public function updatePost(Post $post);

    /**
     * Delete a post from the system.
     *
     * @param Post $post The post to delete.
     * @return bool
     */
    public function deletePost(Post $post);
}</code></pre>

<p>This new interface defines methods for each <em>command</em> within our model. Each
expects a <code>Post</code> instance, and it is up to the implementation to determine how
to use that instance to issue the command. In the case of an insert operation,
our <code>Post</code> does not require an identifier (which is why the value is nullable in
the constructor), but will return a new instance that is guaranteed to have one.
Similarly, the update operation will return the updated post (which may be the
same instance!), and a delete operation will indicate if the operation was
successful.</p>
<h2 id="conclusion">Conclusion</h2>
<p>We're not quite ready to use the new interface; we're using it to set the stage
for the next few chapters, where we look at using zend-db to implement our
persistence, and later creating new controllers to handle blog post
manipulation.</p>



    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../models-and-servicemanager/">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../zend-db-sql-zend-hydrator/">
                    Next <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>



    <div class="help-wanted">
        <p>
            Found a mistake or want to contribute to the documentation?
            <a href="https://github.com/zendframework/tutorials/edit/master/doc/book/in-depth-guide/preparing-databases.md" target="_blank" class="help-wanted__link">
                Edit this page on GitHub!
            </a>
        </p>
    </div>

                
            <!-- content:end -->
            </div>
            <div class="col-md-3 col-xs-12 sidebar">
                
                    <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">tutorials</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            
                
                    <li class="subnavigation__list-item ">
                        <a href="../.." class="subnavigation__link">Tutorials for Zend Framework</a>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">MVC Tutorials</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Getting Started with Zend Framework</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/overview/" class="subnavigation__link">Overview</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/skeleton-application/" class="subnavigation__link">The Skeleton Application</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/modules/" class="subnavigation__link">Modules</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/routing-and-controllers/" class="subnavigation__link">Routing and Controllers</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/database-and-models/" class="subnavigation__link">Database and Models</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/forms-and-actions/" class="subnavigation__link">Forms and Actions</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/conclusion/" class="subnavigation__link">Conclusion</a>
    </li>

            
        </ul>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../unit-testing/" class="subnavigation__link">Unit Testing A zend-mvc Application</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../navigation/" class="subnavigation__link">Adding zend-navigation to the Album Module</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../pagination/" class="subnavigation__link">Adding zend-paginator to the Album Module</a>
    </li>

                            
                                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">In-Depth Tutorial</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../first-module/" class="subnavigation__link">Introducing the Blog Module</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../models-and-servicemanager/" class="subnavigation__link">Models and the ServiceManager</a>
    </li>

            
                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Preparing for Different Databases</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../zend-db-sql-zend-hydrator/" class="subnavigation__link">SQL Abstraction and Object Hydration</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../understanding-routing/" class="subnavigation__link">Understanding the Router</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../zend-form-zend-form-fieldset/" class="subnavigation__link">Making Use of Forms and Fieldsets</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../data-binding/" class="subnavigation__link">Editing and Deleting Data</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../review/" class="subnavigation__link">Reviewing the Blog Module</a>
    </li>

            
        </ul>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../advanced-config/" class="subnavigation__link">Advanced Configuration</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../i18n/" class="subnavigation__link">Internationalization</a>
    </li>

                            
                        </ul>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">Component Tutorials</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../db-adapter/" class="subnavigation__link">Setting Up A Database Adapter</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../event-manager/" class="subnavigation__link">Using the EventManager</a>
    </li>

                            
                        </ul>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">Migration</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">To Version 3</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../migration/to-v3/overview/" class="subnavigation__link">Overview</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../migration/to-v3/components/" class="subnavigation__link">Components</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../migration/to-v3/application/" class="subnavigation__link">Applications</a>
    </li>

            
        </ul>
    </li>

                            
                        </ul>
                    </li>
                
            
        </ul>
    </div>

                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <h5>Zend Framework</h5>
                <ul>
                    <li><a href="https://framework.zend.com/">framework.zend.com</a></li>
                    <li><a href="https://docs.zendframework.com">docs.zendframework.com</a></li>
                    <li><a href="https://packages.zendframework.com">packages.zendframework.com</a></li>
                    <li><a href="https://apigility.org">apigility.org</a></li>
                    <li><a href="https://getexpressive.org/">getexpressive.org</a></li>
                </ul>
            </div>
        </div>

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">

            
            <div class="col-md-9">
                <h4 class="footer__headline">Copyright</h4>
                <p>&copy; 2006-2018 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            
            <div class="col-md-3">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.zendframework.com" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://zendframework-slack.herokuapp.com" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/zendframework" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/zfdevteam" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://tinyletter.com/mwopzend" class="support__link" title="Newsletter"><i class="fa fa-envelope"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://framework.zend.com/blog/feed-rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://framework.zend.com/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script>
        var base_url = '../..',
            siteName = 'tutorials';
    </script>
    <script src="../../js/scripts-a978f1ec1a.js"></script>
        <script src="../../search/require.js"></script>
        <script src="../../search/search.js"></script>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>



</body>


</html>
