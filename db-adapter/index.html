<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Setting Up A Database Adapter - tutorials</title>

    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href="//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Libre+Baskerville:400,400italic,700&subset=latin,latin-ext" rel="stylesheet" type="text/css">
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/zf-web.css" rel="stylesheet">
    <link href="../css/zf.css" rel="stylesheet">
    <link href="../css/prism-zf.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <span class="navbar-brand">
              <a class="logo-link" href="http://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Zend Framework"><img src="../img/zf-logo-mark.svg" height="28" alt="Zend Framework" /></a>
              <a href="..">tutorials</a>
            </span>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">MVC Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Getting Started with Zend Framework</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../getting-started/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../getting-started/skeleton-application/">The Skeleton Application</a>
</li>

        
            
<li >
    <a href="../getting-started/modules/">Modules</a>
</li>

        
            
<li >
    <a href="../getting-started/routing-and-controllers/">Routing and Controllers</a>
</li>

        
            
<li >
    <a href="../getting-started/database-and-models/">Database and Models</a>
</li>

        
            
<li >
    <a href="../getting-started/forms-and-actions/">Forms and Actions</a>
</li>

        
            
<li >
    <a href="../getting-started/conclusion/">Conclusion</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../unit-testing/">Unit Testing A zend-mvc Application</a>
</li>

                        
                            
<li >
    <a href="../navigation/">Adding zend-navigation to the Album Module</a>
</li>

                        
                            
<li >
    <a href="../pagination/">Adding zend-paginator to the Album Module</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">In-Depth Tutorial</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../in-depth-guide/first-module/">Introducing the Blog Module</a>
</li>

        
            
<li >
    <a href="../in-depth-guide/models-and-servicemanager/">Models and the ServiceManager</a>
</li>

        
            
<li >
    <a href="../in-depth-guide/preparing-databases/">Preparing for Different Databases</a>
</li>

        
            
<li >
    <a href="../in-depth-guide/zend-db-sql-zend-hydrator/">SQL Abstraction and Object Hydration</a>
</li>

        
            
<li >
    <a href="../in-depth-guide/understanding-routing/">Understanding the Router</a>
</li>

        
            
<li >
    <a href="../in-depth-guide/zend-form-zend-form-fieldset/">Making Use of Forms and Fieldsets</a>
</li>

        
            
<li >
    <a href="../in-depth-guide/data-binding/">Editing and Deleting Data</a>
</li>

        
            
<li >
    <a href="../in-depth-guide/review/">Reviewing the Blog Module</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../advanced-config/">Advanced Configuration</a>
</li>

                        
                            
<li >
    <a href="../i18n/">Internationalization</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Component Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li class="active">
    <a href="./">Setting Up A Database Adapter</a>
</li>

                        
                            
<li >
    <a href="../event-manager/">Using the EventManager</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Migration <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">To Version 3</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../migration/to-v3/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../migration/to-v3/components/">Components</a>
</li>

        
            
<li >
    <a href="../migration/to-v3/application/">Applications</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" class="component-toggle" data-toggle="tooltip" data-placement="bottom" title="Show component list">
                        <i class="fa fa-book"></i> Components
                    </a>
                </li>

                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/zendframework/tutorials">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <!-- content:begin -->
    <div id="page-top" class="container docs">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#setting-up-a-database-adapter">Setting up a database adapter</a></li>
        
            <li><a href="#installing-zend-db">Installing zend-db</a></li>
        
            <li><a href="#configuring-the-default-adapter">Configuring the default adapter</a></li>
        
            <li><a href="#configuring-named-adapters">Configuring named adapters</a></li>
        
    
    </ul>

    
    <ul class="pager hidden-print">
      <li class="previous">
        <a rel="prev" href="../i18n/"><i class="fa fa-arrow-left"></i> Previous</a>
      </li>
      <li class="next">
        <a rel="next" href="../event-manager/">Next <i class="fa fa-arrow-right"></i></a>
      </li>
    </ul>
    
</div></div>
        <div class="col-md-9" role="main">

<ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="..">tutorials</a> &raquo;</li>
  
    
      
        <li>Component Tutorials &raquo;</li>
      
    
  
  <li class="active">Setting Up A Database Adapter</li>
</ol>

<h1 id="setting-up-a-database-adapter">Setting up a database adapter</h1>
<p>zend-db provides a general purpose database abstraction layer. At its heart is
the <code>Adapter</code>, which abstracts common database operations across the variety of
drivers we support.</p>
<p>In this guide, we will document how to configure both a single, default adapter
as well as multiple adapters (which may be useful in architectures that have a
cluster of read-only replicated servers and a single writable server of record).</p>
<h2 id="installing-zend-db">Installing zend-db</h2>
<p>First, install zend-db using Composer:</p>
<pre class="codehilite"><code class="language-bash linenums">$ composer require zendframework/zend-db</code></pre>

<p>If you are using <a href="https://zendframework.github.io/zend-component-installer/">zend-component-installer</a>
(installed by default with the skeleton application, and optionally for
Expressive applications), you will be prompted to install the package
configuration.</p>
<ul>
<li>For zend-mvc applications, choose either <code>application.config.php</code> or
  <code>modules.config.php</code>.</li>
<li>For Expressive applications, choose <code>config/config.php</code>.</li>
</ul>
<p>If you are not using the installer, you will need to manually configure add the
component to your application.</p>
<ul>
<li>
<p>For zend-mvc applications, update your list of modules in either
  <code>config/application.config.php</code> or <code>config/modules.config.php</code> to add an
  entry for <code>'Zend\Db'</code> at the top of the list:
  <pre class="codehilite"><code class="language-php linenums">&lt;?php
  // In config/modules.config.php
  return [
    'Zend\Db', // &lt;-- This line
    'Zend\Form', 
    /* ... */
  ];

  // OR in config/application.config.php
  return [
  /* ... */
  // Retrieve list of modules used in this application.
  'modules' =&gt; [
    'Zend\Db', // &lt;-- This line
    'Zend\Form', 
    /* ... */
  ],
  /* ... */</code></pre></p>
</li>
<li>
<p>For Expressive applications, create a new file,
  <code>config/autoload/zend-db.global.php</code>, with the following contents:</p>
</li>
</ul>
<pre class="codehilite"><code class="language-php linenums">&lt;?php
use Zend\Db\ConfigProvider;

return (new ConfigProvider())();</code></pre>

<h2 id="configuring-the-default-adapter">Configuring the default adapter</h2>
<p>Within your service factories, you may retrieve the default adapter from your application container using the
class name <code>Zend\Db\Adapter\AdapterInterface</code>:</p>
<pre class="codehilite"><code class="language-php linenums">use Zend\Db\Adapter\AdapterInterface;

function ($container) {
    return new SomeServiceObject($container-&gt;get(AdapterInterface::class));
}</code></pre>

<p>When installed and configured, the factory associated with <code>AdapterInterface</code>
will look for a top-level <code>db</code> key in the configuration, and use it to create an
adapter. As an example, the following would connect to a MySQL database using
PDO, and the supplied PDO DSN:</p>
<pre class="codehilite"><code class="language-php linenums">// In config/autoload/global.php
return [
    'db' =&gt; [
        'driver' =&gt; 'Pdo',
        'dsn'    =&gt; 'mysql:dbname=zftutorial;host=localhost;charset=utf8',
    ],
];</code></pre>

<p>More information on adapter configuration can be found in the docs for
<a href="http://zendframework.github.io/zend-db/adapter/#creating-an-adapter-using-dependency-injection">Zend\Db\Adapter</a>.</p>
<h2 id="configuring-named-adapters">Configuring named adapters</h2>
<p>Sometimes you may need multiple adapters. As an example, if you work with a
cluster of databases, one may allow write operations, while another may be
read-only.</p>
<p>zend-db provides an <a href="https://zendframework.github.io/zend-servicemanager/configuring-the-service-manager/#abstract-factories">abstract factory</a>,
<code>Zend\Db\Adapter\AdapterAbstractServiceFactory</code>, for this purpose. To use it,
you will need to create named configuration keys under <code>db.adapters</code>, each with
configuration for an adapter:</p>
<pre class="codehilite"><code class="language-php linenums">// In config/autoload/global.php
return [
    'db' =&gt; [
        'adapters' =&gt; [
            'Application\Db\WriteAdapter' =&gt; [
                'driver' =&gt; 'Pdo',
                'dsn'    =&gt; 'mysql:dbname=application;host=canonical.example.com;charset=utf8',
            ],
            'Application\Db\ReadOnlyAdapter' =&gt; [
                'driver' =&gt; 'Pdo',
                'dsn'    =&gt; 'mysql:dbname=application;host=replica.example.com;charset=utf8',
            ],
        ],
    ],
];</code></pre>

<p>You retrieve the database adapters using the keys you define, so ensure they are
unique to your application, and descriptive of their purpose!</p>
<h3 id="retrieving-named-adapters">Retrieving named adapters</h3>
<p>Retrieve named adapters in your service factories just as you would another
service:</p>
<pre class="codehilite"><code class="language-php linenums">function ($container) {
    return new SomeServiceObject($container-&gt;get('Application\Db\ReadOnlyAdapter));
}</code></pre>

<h3 id="using-the-adapterabstractservicefactory-as-a-factory">Using the AdapterAbstractServiceFactory as a factory</h3>
<p>Depending on what application container you use, abstract factories may not be
available. Alternately, you may want to reduce lookup time when retrieving an
adapter from the container (abstract factories are consulted last!).
zend-servicemanager abstract factories work as factories in their own right, and
are passed the service name as an argument, allowing them to vary their return
value based on requested service name. As such, you can add the following
service configuration as well:</p>
<pre class="codehilite"><code class="language-php linenums">use Zend\Db\Adapter\AdapterAbstractServiceFactory;

// If using zend-mvc:
// In module/YourModule/config/module.config.php
'service_manager' =&gt; [
    'factories' =&gt; [
        'Application\Db\WriteAdapter' =&gt; AdapterAbstractServiceFactory::class,
    ],
],

// If using Expressive
'dependencies' =&gt; [
    'factories' =&gt; [
        'Application\Db\WriteAdapter' =&gt; AdapterAbstractServiceFactory::class,
    ],
],</code></pre>

<hr />


<nav>
  <ul class="pager hidden-print">
    <li class="previous">
      <a rel="prev" href="../i18n/"><i class="fa fa-arrow-left"></i> Previous</a>
    </li>
    <li class="next">
      <a rel="next" href="../event-manager/">Next <i class="fa fa-arrow-right"></i></a>
    </li>
  </ul>
</nav>
</div>
        
    </div>
    <!-- content:end -->

    <div id="footerwrap">
    <div class="container">
        <div class="row site-map">
            <div class="col-lg-3">
              <p>
                <strong>Zend Framework</strong><br />
                <a href="http://framework.zend.com/">framework.zend.com</a><br />
                <a href="https://docs.zendframework.com">docs.zendframework.com</a><br />
                <a href="https://packages.zendframework.com">packages.zendframework.com</a><br />
                <a href="https://apigility.org">apigility.org</a><br />
              </p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 centered">
                <a class="back-to-top" href="#page-top"><i class="fa fa-chevron-circle-up fa-4" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="spacing"></div>

        <div class="row">
            <div class="col-lg-8">
                <h4>Copyright</h4>
                <div class="hline-w"></div>

                <p>&copy; 2006-2016 by <a href="http://www.zend.com">Zend</a>, a <a href="http://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            <div class="col-lg-4">
                <h4>Contacts</h4>
                <div class="hline-w"></div>
                <p>
                    <a href="irc://irc.freenode.net/zftalk" class="btn-social btn-outline" alt="IRC" title="IRC"><i class="fa fa-comment"></i></a>
                    <a href="https://github.com/zendframework" class="btn-social btn-outline" alt="Github" title="Github"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/zfdevteam" class="btn-social btn-outline" alt="Twitter" title="Twitter"><i class="fa fa-twitter"></i></a>
                </p>
            </div>
        </div>
    </div>
</div>


    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/prism-zf.js"></script>

    <script>var base_url = '..';</script>
    <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
    <script src="../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <div class="zf-components">
  <div class="zf-components-grid">
    <div class="zf-logo">
      <a href="http://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../img/zf-logo-mark.svg" alt="Zend Framework" width="250" /></a>
    </div>

    <div class="component-list"></div>

    <p class="zf-components-rollup"><a href="#">Hide list</a></p>
  </div>
</div>

    <script>
  // Prepare the component list dropdown for display
  $(function () {
    var components = $(".zf-components"),
        componentList = components.find(".component-list"),
        sidebar = $(".bs-sidebar.affix"),
        sidebarInitialPos = sidebar.css("position"),
        hidden,
        componentToggle = $(".component-toggle"),
        navbar = $(".navbar-fixed-top"),
        rollUpLink = $(".zf-components-rollup a");

    // Initial setup on document load
    components.insertBefore(navbar);
    $(".zf-logo a").tooltip();
    componentToggle.tooltip();
    rollUpLink.attr({ href: "#", alt: "Hide component list" });

    // Cast initial sidebar position value
    if (undefined === sidebarInitialPos) {
      sidebarInitialPos = "fixed";
    }

    // Setup onclick events to toggle list
    componentToggle.click(toggleComponentList);
    rollUpLink.click(toggleComponentList);

    // Toggle the component list display
    function toggleComponentList(event) {
      event.preventDefault();

      if (hidden === undefined) {
        // Not loaded yet; load and display.
        loadComponentList();
        return;
      }

      if (hidden) {
        // Hidden; display.
        showComponentList();
        return;
      }

      // Currently visible; hide
      hideComponentList();
    }

    // Show the component list
    function showComponentList() {
      navbar.css({position: "relative"});
      sidebar.css({position: "relative"});
      components
        .css({"margin-top": "-" + components.outerHeight() + "px"})
        .show()
        .animate({"margin-top": 0}, {
          complete: function () {
            componentToggle
              .data("placement", "top")
              .attr("data-original-title", "Hide component list");
            hidden = false;
          },
          queue: false
        });
    }

    // Hide the component list
    function hideComponentList() {
      components.animate({"margin-top": "-" + components.outerHeight() + "px"}, {
        complete: function () {
          navbar.css({position: "fixed"});
          sidebar.css({position: sidebarInitialPos});
          componentToggle
            .data("placement", "bottom")
            .attr("data-original-title", "Show component list");
          components.hide();
          hidden = true;
        },
        queue: false
      });
      sidebar.animate({ top: sidebarInitialTop + "px" }, { queue: false});
    }

    // Inject a component into the componet list DOM.
    function injectComponent(index, component) {
      componentList.append('<div class="component"><h4><a href="' + component.url + '">' + component.name + '</a></h4><p>' + component.description + '</p></div>');
    }

    // Parse the component list, build the DOM, and display it.
    function parseComponentList(components) {
      $.each(components, injectComponent);
      showComponentList();
    }

    // Fetch the component list and display it.
    function loadComponentList () {
      $.ajax({
        url: "//docs.zendframework.com/zf-mkdoc-theme/scripts/zf-component-list.json",
        dataType: "text json",
        success: parseComponentList,
        error: function (e) {
          console.log("Error occurred with XHR call", e);
        }
      });
    }
  });
</script>
    </body>

</html>
